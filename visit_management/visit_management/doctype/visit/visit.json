{
	"doctype": "DocType",
	"name": "Visit",
	"module": "Visit Management",
	"custom": 0,
	"istable": 0,
	"is_submittable": 0,
	"autoname": "naming_series:",
	"track_changes": 1,
	"fields": [
		{"fieldname": "naming_series", "label": "Series", "fieldtype": "Select", "default": "VIS-.YYYY.-", "options": "VIS-.YYYY.-"},
		{"fieldname": "status", "label": "Status", "fieldtype": "Select", "options": "Planned\nIn Progress\nCompleted\nCancelled", "reqd": 1, "default": "Planned"},
		{"fieldname": "scheduled_time", "label": "Scheduled Time", "fieldtype": "Datetime", "reqd": 1, "default": "Now"},
		{"fieldname": "assigned_to", "label": "Assigned To", "fieldtype": "Link", "options": "User", "reqd": 1},
		{"fieldname": "client_section", "label": "Client", "fieldtype": "Section Break"},
		{"fieldname": "client_type", "label": "Client Type", "fieldtype": "Select", "options": "CRM Lead\nCRM Deal\nCRM Organization\nCustomer", "reqd": 1},
		{"fieldname": "client", "label": "Client", "fieldtype": "Dynamic Link", "options": "client_type", "reqd": 1},
		{"fieldname": "details_section", "label": "Details", "fieldtype": "Section Break"},
		{"fieldname": "subject", "label": "Purpose", "fieldtype": "Select", "options": "Sales Call\nFollow-up\nDemo\nMaintenance\nCollection\nInspection"},
		{"fieldname": "notes", "label": "Notes", "fieldtype": "Small Text"},
		{"fieldname": "visit_outcome", "label": "Visit Outcome", "fieldtype": "Select", "options": "Successful\nUnsuccessful\nFollow-up Required", "depends_on": "eval:doc.status=='In Progress' || doc.status=='Completed'", "mandatory_depends_on": "eval:doc.status=='Completed'"},
		{"fieldname": "next_follow_up", "label": "Next Follow-up", "fieldtype": "Datetime", "depends_on": "eval:doc.visit_outcome=='Follow-up Required'"},
		{"fieldname": "address", "label": "Address", "fieldtype": "Link", "options": "Address"},
		{"fieldname": "location", "label": "Location", "fieldtype": "Geolocation", "mandatory_depends_on": "eval:doc.status=='Completed'"},
		{"fieldname": "check_in_photo", "label": "Check-in Photo", "fieldtype": "Attach Image"},
		{"fieldname": "check_out_photo", "label": "Check-out Photo", "fieldtype": "Attach Image"},
		{"fieldname": "visit_logs", "label": "Visit Logs", "fieldtype": "Table", "options": "Visit Log"},
		{"fieldname": "attendance_section", "label": "Attendance", "fieldtype": "Section Break"},
		{"fieldname": "check_in_time", "label": "Check-in Time", "fieldtype": "Datetime", "read_only": 1},
		{"fieldname": "check_out_time", "label": "Check-out Time", "fieldtype": "Datetime", "read_only": 1},
		{"fieldname": "visit_duration_minutes", "label": "Visit Duration (minutes)", "fieldtype": "Int", "read_only": 1, "depends_on": "eval:doc.check_out_time"},
		{"fieldname": "report_section", "label": "Report", "fieldtype": "Section Break", "depends_on": "eval:doc.status=='Completed'"},
		{"fieldname": "report_summary", "label": "Report Summary", "fieldtype": "Small Text", "depends_on": "eval:doc.status=='Completed'", "mandatory_depends_on": "eval:doc.status=='Completed'"},
		{"fieldname": "report_attachment", "label": "Report Attachment", "fieldtype": "Attach", "depends_on": "eval:doc.status=='Completed'"},
		{"fieldname": "actions_section", "label": "Actions", "fieldtype": "Section Break"},
		{"fieldname": "check_in", "label": "Check In", "fieldtype": "Button", "options": "check_in"},
		{"fieldname": "check_out", "label": "Check Out", "fieldtype": "Button", "options": "check_out"},
		{"fieldname": "sb_maintenance", "fieldtype": "Section Break", "label": "Maintenance"},
		{"fieldname": "support_issue", "fieldtype": "Link", "label": "Support Issue", "options": "Issue", "depends_on": "eval:doc.subject=='Maintenance'"},
		{"fieldname": "maintenance_details", "fieldtype": "Small Text", "label": "Maintenance Details", "depends_on": "eval:doc.subject=='Maintenance'", "mandatory_depends_on": "eval:doc.subject=='Maintenance' && doc.client_type=='Customer'"},
		{"fieldname": "maintenance_visit", "fieldtype": "Link", "label": "Maintenance Visit", "options": "Maintenance Visit", "depends_on": "eval:doc.subject=='Maintenance' && doc.status=='Completed'"},
		{"fieldname": "sb_mv_draft", "fieldtype": "Section Break", "label": "Maintenance Visit Draft", "depends_on": "eval:doc.subject=='Maintenance'"},
		{"fieldname": "mv_item", "fieldtype": "Link", "label": "Item", "options": "Item", "depends_on": "eval:doc.subject=='Maintenance'"},
		{"fieldname": "mv_serial_no", "fieldtype": "Link", "label": "Serial No", "options": "Serial No", "depends_on": "eval:doc.subject=='Maintenance'"},
		{"fieldname": "mv_problem_reported", "fieldtype": "Small Text", "label": "Problem Reported", "depends_on": "eval:doc.subject=='Maintenance'"},
		{"fieldname": "mv_work_done", "fieldtype": "Small Text", "label": "Work Done (Draft)", "depends_on": "eval:doc.subject=='Maintenance'"}
	],
	"permissions": [
		{"role": "System Manager", "read": 1, "write": 1, "create": 1, "delete": 1},
		{"role": "Field Sales Executive", "read": 1, "write": 1, "create": 1},
		{"role": "Sales Manager", "read": 1, "write": 1, "create": 1, "delete": 1}
	]
}

