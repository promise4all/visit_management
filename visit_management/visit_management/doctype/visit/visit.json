{
	"doctype": "DocType",
	"name": "Visit",
	"module": "Visit Management",
	"custom": 0,
	"istable": 0,
	"is_submittable": 1,
	"autoname": "naming_series:",
	"track_changes": 1,
	"fields": [
		{"fieldname": "naming_series", "label": "Series", "fieldtype": "Select", "default": "VIS-.YYYY.-", "options": "VIS-.YYYY.-"},
		{"fieldname": "status", "label": "Status", "fieldtype": "Select", "options": "Planned\nIn Progress\nCompleted\nCancelled", "reqd": 1, "default": "Planned"},
		{"fieldname": "scheduled_time", "label": "Scheduled Time", "fieldtype": "Datetime", "reqd": 1, "default": "Now"},
		{"fieldname": "assigned_to", "label": "Assigned To", "fieldtype": "Link", "options": "User", "reqd": 1},
		{"fieldname": "client_section", "label": "Client", "fieldtype": "Section Break"},
		{"fieldname": "client_type", "label": "Client Type", "fieldtype": "Select", "options": "CRM Lead\nCRM Deal\nCRM Organization\nCustomer", "reqd": 1},
		{"fieldname": "client", "label": "Client", "fieldtype": "Dynamic Link", "options": "client_type", "reqd": 1},
		{"fieldname": "contact", "label": "Contact", "fieldtype": "Link", "options": "Contact"},
		{"fieldname": "column_break_contact", "fieldtype": "Column Break"},
		{"fieldname": "contact_email", "label": "Contact Email", "fieldtype": "Data", "read_only": 1, "fetch_from": "contact.email_id", "depends_on": "eval:doc.contact"},
		{"fieldname": "contact_phone", "label": "Contact Phone", "fieldtype": "Data", "read_only": 1, "fetch_from": "contact.phone", "depends_on": "eval:doc.contact"},
		{"fieldname": "contact_mobile", "label": "Contact Mobile", "fieldtype": "Data", "read_only": 1, "fetch_from": "contact.mobile_no", "depends_on": "eval:doc.contact"},
		{"fieldname": "contact_designation", "label": "Position", "fieldtype": "Data", "read_only": 1, "fetch_from": "contact.designation", "depends_on": "eval:doc.contact"},
		{"fieldname": "details_section", "label": "Details", "fieldtype": "Section Break"},
		{"fieldname": "subject", "label": "Purpose", "fieldtype": "Select", "options": "Sales Call\nFollow-up\nDemo\nMaintenance\nCollection\nInspection"},
		{"fieldname": "address", "label": "Address", "fieldtype": "Link", "options": "Address"},
		{"fieldname": "column_break_details", "fieldtype": "Column Break"},
		{"fieldname": "visit_brief", "label": "Visit Brief", "fieldtype": "Small Text"},
		{"fieldname": "outcome_section", "label": "Outcome", "fieldtype": "Section Break", "depends_on": "eval:doc.status=='In Progress' || doc.status=='Completed'"},
		{"fieldname": "visit_outcome", "label": "Visit Outcome", "fieldtype": "Select", "options": "\nSuccessful\nUnsuccessful\nFollow-up Required", "mandatory_depends_on": "eval:doc.status=='Completed'"},
		{"fieldname": "next_follow_up", "label": "Next Follow-up", "fieldtype": "Datetime", "depends_on": "eval:doc.visit_outcome=='Follow-up Required'"},
		{"fieldname": "attendance_section", "label": "Attendance", "fieldtype": "Section Break", "depends_on": "eval:doc.check_in_time"},
		{"fieldname": "locations_map", "label": "Visit Locations", "fieldtype": "HTML", "options": "<div id='visit_locations_map'></div>"},
		{"fieldname": "column_break_times", "fieldtype": "Column Break"},
		{"fieldname": "check_in_time", "label": "Check-in Time", "fieldtype": "Datetime", "read_only": 1},
		{"fieldname": "check_out_time", "label": "Check-out Time", "fieldtype": "Datetime", "read_only": 1},
		{"fieldname": "visit_duration_minutes", "label": "Visit Duration (minutes)", "fieldtype": "Int", "read_only": 1, "depends_on": "eval:doc.check_out_time"},
		{"fieldname": "section_break_locations", "fieldtype": "Section Break", "label": "Locations"},
		{"fieldname": "check_in_location", "label": "Check-in Location", "fieldtype": "Small Text", "read_only": 1},
		{"fieldname": "column_break_locations", "fieldtype": "Column Break"},
		{"fieldname": "check_out_location", "label": "Check-out Location", "fieldtype": "Small Text", "read_only": 1},
		{"fieldname": "section_break_photos", "label": "Photos", "fieldtype": "Section Break", "collapsible": 1},
		{"fieldname": "check_in_photo_preview", "label": "Check-in Photo", "fieldtype": "HTML"},
		{"fieldname": "check_in_photo", "fieldtype": "Attach", "hidden": 1},
		{"fieldname": "column_break_photos", "fieldtype": "Column Break"},
		{"fieldname": "check_out_photo_preview", "label": "Check-out Photo", "fieldtype": "HTML"},
		{"fieldname": "check_out_photo", "fieldtype": "Attach", "hidden": 1},
		{"fieldname": "section_break_logs", "label": "Activity Log", "fieldtype": "Section Break", "collapsible": 1},
		{"fieldname": "visit_logs", "label": "Visit Logs", "fieldtype": "Table", "options": "Visit Log"},
		{"fieldname": "report_section", "label": "Report", "fieldtype": "Section Break", "depends_on": "eval:doc.status=='In Progress' || doc.status=='Completed' || doc.docstatus==1"},
		{"fieldname": "competitor_info", "label": "Competitor Information", "fieldtype": "Small Text"},
		{"fieldname": "existing_fleet", "label": "Existing Fleet Information", "fieldtype": "Small Text"},
		{"fieldname": "requirements_received", "label": "Any Requirements Received", "fieldtype": "Small Text"},
		{"fieldname": "future_prospects", "label": "Future Prospects", "fieldtype": "Small Text"},
		{"fieldname": "product_target", "label": "Potential Product Target", "fieldtype": "Small Text"},
		{"fieldname": "customer_feedback", "label": "Customer Feedback", "fieldtype": "Small Text"},
		{"fieldname": "report_attachment", "label": "Report Attachment", "fieldtype": "Attach"},
		{"fieldname": "additional_notes", "label": "Additional Notes", "fieldtype": "Small Text"},
		{"fieldname": "actions_section", "label": "Actions", "fieldtype": "Section Break"},
		{"fieldname": "check_in", "label": "Check In", "fieldtype": "Button", "options": "check_in"},
		{"fieldname": "check_out", "label": "Check Out", "fieldtype": "Button", "options": "check_out"},
		{"fieldname": "sb_maintenance", "fieldtype": "Section Break", "label": "Maintenance"},
		{"fieldname": "support_issue", "fieldtype": "Link", "label": "Support Issue", "options": "Issue", "depends_on": "eval:doc.subject=='Maintenance'"},
		{"fieldname": "maintenance_details", "fieldtype": "Small Text", "label": "Maintenance Details", "depends_on": "eval:doc.subject=='Maintenance'", "mandatory_depends_on": "eval:doc.subject=='Maintenance' && doc.client_type=='Customer'"},
		{"fieldname": "maintenance_visit", "fieldtype": "Link", "label": "Maintenance Visit", "options": "Maintenance Visit", "depends_on": "eval:doc.subject=='Maintenance' && doc.status=='Completed'"},
		{"fieldname": "sb_mv_draft", "fieldtype": "Section Break", "label": "Maintenance Visit Draft", "depends_on": "eval:doc.subject=='Maintenance'"},
		{"fieldname": "mv_item", "fieldtype": "Link", "label": "Item", "options": "Item", "depends_on": "eval:doc.subject=='Maintenance'"},
		{"fieldname": "mv_serial_no", "fieldtype": "Link", "label": "Serial No", "options": "Serial No", "depends_on": "eval:doc.subject=='Maintenance'"},
		{"fieldname": "mv_problem_reported", "fieldtype": "Small Text", "label": "Problem Reported", "depends_on": "eval:doc.subject=='Maintenance'"},
		{"fieldname": "mv_work_done", "fieldtype": "Small Text", "label": "Work Done (Draft)", "depends_on": "eval:doc.subject=='Maintenance'"}
	],
	"permissions": [
		{"role": "System Manager", "read": 1, "write": 1, "create": 1, "delete": 1, "submit": 1, "cancel": 1, "amend": 1},
		{"role": "Field Sales Executive", "read": 1, "write": 1, "create": 1},
		{"role": "Sales Manager", "read": 1, "write": 1, "create": 1, "delete": 1, "cancel": 1, "amend": 1}
	]
}

